# Dataset Management

This directory contains dataset manifests and documentation. **Actual dataset files are stored in Cloudflare R2** to keep the git repository lightweight.

## üèóÔ∏è Architecture

```
datasets/
‚îú‚îÄ‚îÄ manifests/          # Dataset metadata (tracked in git)
‚îÇ   ‚îî‚îÄ‚îÄ *.json         # Manifest files with R2 paths and checksums
‚îú‚îÄ‚îÄ */                 # Dataset directories (contents in .gitignore)
‚îÇ   ‚îî‚îÄ‚îÄ *.zip         # Downloaded from R2, not tracked in git
‚îî‚îÄ‚îÄ README.md         # This file
```

## üöÄ Quick Start

### 1. Setup Environment
```bash
# Install dependencies and create .env
make setup

# Edit .env with your Cloudflare R2 credentials
nano .env
```

### 2. Download Datasets
```bash
# Download all datasets
make download-data

# Download specific dataset
make download-visdrone
```

### 3. Upload Datasets (Maintainers)
```bash
# Upload all datasets to R2
make upload-data

# Upload specific dataset
make upload-visdrone
```

## üìä Available Datasets

| Dataset | Size | Images | Status | Manifest |
|---------|------|--------|--------|----------|
| VisDrone | 17GB | 10,209 + 261K frames | ‚úÖ Downloaded | `manifests/visdrone.json` |
| UAVDT | 6.79GB | 77,819 | ‚úÖ Downloaded | `manifests/uavdt.json` |
| Anti-UAV410 | 6.4GB | 410 sequences | ‚úÖ Downloaded | Create manifest |
| SeaDronesSee | 413MB | 14,227 | ‚úÖ Downloaded | Create manifest |
| YOLO Drone | 360MB | 1,359 | ‚úÖ Downloaded | Create manifest |
| DUT Anti-UAV | 13MB | 10,000 | ‚úÖ Downloaded | Create manifest |
| Pawe≈Çczyk & Wojtyra | 1.3MB | 56,821 | ‚úÖ Downloaded | Create manifest |

## üîê Cloudflare R2 Setup

### 1. Create R2 Bucket
1. Go to [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. Navigate to R2 > Create Bucket
3. Name: `drone-datasets-hackathon`
4. Region: Automatic

### 2. Generate API Credentials
1. R2 > Manage API tokens
2. Create token with:
   - Permissions: Object Read & Write
   - Specify bucket: `drone-datasets-hackathon`
3. Copy credentials to `.env`

### 3. Configure Public Access (Optional)
1. R2 > Settings > Public Access
2. Add custom domain: `datasets.yourdomain.com`
3. Update `R2_PUBLIC_URL` in `.env`

## üì¶ Dataset Operations

### List Available Datasets
```bash
make list-datasets
# or
uv run python scripts/data/r2_manager.py list
```

### Download Dataset
```bash
# Download with validation
uv run python scripts/data/r2_manager.py download --dataset visdrone

# Skip validation (faster)
uv run python scripts/data/r2_manager.py download --dataset visdrone --no-validate
```

### Upload Dataset
```bash
# Upload and update checksums
uv run python scripts/data/r2_manager.py upload --dataset visdrone
```

### Sync All Datasets
```bash
# Download missing or updated datasets
make sync-data
```

## üìã Manifest Format

Each dataset has a JSON manifest in `datasets/manifests/` with:

```json
{
  "name": "dataset_name",
  "version": "1.0",
  "files": [
    {
      "local_path": "relative/path/to/file.zip",
      "r2_key": "dataset_name/v1.0/file.zip",
      "size_bytes": 1234567890,
      "md5": "...",
      "sha256": "..."
    }
  ],
  "metadata": {...}
}
```

## üîÑ Workflow

### For Contributors
1. Clone repository
2. Configure R2 credentials in `.env`
3. Download datasets: `make download-data`
4. Work on code (datasets stay out of git)
5. Commit code changes only

### For CI/CD
```yaml
- name: Download datasets
  env:
    R2_ACCESS_KEY_ID: ${{ secrets.R2_ACCESS_KEY_ID }}
    R2_SECRET_ACCESS_KEY: ${{ secrets.R2_SECRET_ACCESS_KEY }}
  run: make download-visdrone
```

## üßπ Cleanup

```bash
# Remove downloaded datasets (keeps manifests)
make clean-data

# Check what's tracked in git
make git-status
```

## ‚ö†Ô∏è Important Notes

1. **Never commit dataset files** - They're excluded via `.gitignore`
2. **Always use manifests** - Ensures reproducible downloads
3. **Update checksums** - When uploading new versions
4. **Version datasets** - Use `v1.0`, `v1.1` etc. in R2 paths

## üõ†Ô∏è Troubleshooting

### Connection Issues
```bash
# Check R2 configuration
make check-r2

# Test connection
make test-connection
```

### Checksum Mismatch
- Re-download with `--no-validate`
- Or update manifest with correct checksums

### Missing Credentials
- Copy `.env.example` to `.env`
- Add R2 credentials from Cloudflare dashboard

## üìö Documentation

- [Data Architecture](../DATA_ARCHITECTURE.md) - Full architecture details
- [R2 Manager Script](../scripts/data/r2_manager.py) - Dataset management tool
- [Cloudflare R2 Docs](https://developers.cloudflare.com/r2/) - Official R2 documentation

## ‚úÖ TODO: Manifest Heuristics Enhancements

The curated manifests generated by `scripts/build_manifests.py` can be enriched further. Planned, but not yet implemented:

- COCO pairing: parse `annotations/*.json`, pair to images, include `ann_count`, `categories`, `has_segm`. Flag: `--parse-coco`.
- Pascal/VOC pairing: parse `Annotations/*.xml`, pair to images, include `ann_count`, `categories`. Flag: `--parse-voc`.
- YOLO data.yaml: read `data.yaml` to resolve train/val/test splits and class names; enrich media-index. Flag: `--parse-yolo-config`.
- Tracking/MOT: detect sequences (e.g., `*/gt/gt.txt`), emit sequence-level records and optional frame-level pairs. Flags: `--parse-mot`, `--include-frames`.
- Calibration/config: tag calibration YAML/JSON/TXT and link to sequences when possible. Flag: `--include-calibration`.
- Media probing: optionally read image dims and video fps/duration for `width`, `height`, `fps`, `duration`. Flags: `--probe-images`, `--probe-videos`.

These will be gated behind CLI flags to avoid heavy I/O by default.
